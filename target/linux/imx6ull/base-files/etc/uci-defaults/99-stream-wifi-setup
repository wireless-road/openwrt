#!/bin/sh
#
# Copyright (C) 2013-2015 OpenWrt.org
#

. /lib/functions/uci-defaults.sh

board=$(board_name)

board_config_update

case "$board" in
video_stream_wifi|\
audio_stream_wifi|\
flexcan_wifi|\
lorawan_gateway_wifi)
	touch /etc/config/wireless;
	uci set wireless.default_radio0=wifi-iface
	uci set wireless.@wifi-iface[0].mode="ap";
	uci set wireless.@wifi-iface[0].network="lan";
#	touch /etc/config/network;
#	uci set network.wlan='interface';
#	uci set network.wlan.proto='dhcp';
	uci commit;
	;;
*)
	;;
esac

case "$board" in
gs)
	uci set wireless.@wifi-iface[0].hidden="1";
	uci set wireless.@wifi-iface[0].ssid="openwrt";
	uci set wireless.@wifi-iface[0].encryption="psk2";
	uci set wireless.@wifi-iface[0].key="12345678";
	uci commit;
	;;
lorawan_gateway_wifi)
	# WIRELESS AP+STA mode #
	uci set wireless.radio0=wifi-device
    uci set wireless.radio0.type='mac80211'
	uci set wireless.radio0.path='soc0/soc/2100000.aips-bus/2194000.usdhc/mmc_host/mmc1/mmc1:0001/mmc1:0001:1'
	uci set wireless.radio0.channel='1'
	uci set wireless.radio0.band='2g'
	uci set wireless.radio0.htmode='HT20'
	uci set wireless.radio0.short_preamble='1'
	uci delete wireless.@wifi-iface[0]
	uci add wireless wifi-iface
	uci set wireless.@wifi-iface[0].device='radio0'
	uci set wireless.@wifi-iface[0].ifname='sta0'
	uci set wireless.@wifi-iface[0].ssid='ChangeMe'
	uci set wireless.@wifi-iface[0].encryption='psk2'
	uci set wireless.@wifi-iface[0].key='12345678'
	uci set wireless.@wifi-iface[0].mode='sta'
	uci set wireless.@wifi-iface[0].disabled='0'
	uci add wireless wifi-iface
	uci set wireless.@wifi-iface[1].device='radio0'
	uci set wireless.@wifi-iface[1].ifname='ap0'
	uci set wireless.@wifi-iface[1].mode='ap'
	uci set wireless.@wifi-iface[1].ssid='m2mtele.com'
	uci set wireless.@wifi-iface[1].encryption='psk2'
	uci set wireless.@wifi-iface[1].key='12345678'
	uci set wireless.@wifi-iface[1].disabled='0'
	uci commit wireless
	# Network interfaces #
	uci delete network.lan
	uci delete network.globals
	uci delete network.@device[0]
	uci set network.lan=interface
	uci set network.lan.proto='static'
	uci set network.lan.device='ap0'
	uci set network.lan.ipaddr='192.168.4.1'
	uci set network.lan.netmask='255.255.255.0'
	uci set network.wwan=interface
	uci set network.wwan.proto='dhcp'
	uci set network.wwan.device='sta0'
	uci commit network
	;;
*)
	;;
esac

board_config_flush

exit 0
